/**
 * angular-webspeech-directive
 * @version v0.0.1 - 2013-10-20
 * @link https://github.com/jonniespratley/angular-webspeech-directive
 * @author Jonnie Spratley <jonniespratley@me.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
(function(){"use strict";var a;a=angular.module("jonniespratley.angularWebSpeechDirective",[]),a.service("jsSpeechFactory",["$rootScope",function(){var a;return a={icons:{start:"http://goo.gl/dBS39a",recording:"http://goo.gl/7JLqdm",blocked:"http://goo.gl/j8MZhD"},messages:{info_speak_now:"Speak now.",info_stop:"Proccessing your voice...",info_no_speech:'No Speech was detected. You may need to adjust your <a href="//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892">microphone settings</a>.',info_no_mic:"No microphone was found. Ensure that a microphone is installed and that",info_blocked:'Permission to use microphone is blocked. To change, go to <a href="chrome://settings/contentExceptions#media-stream">chrome://settings/contentExceptions#media-stream</a>.',info_denied:"Permission to use microphone was denied.",info_setup:"Click on the microphone icon to enable Web Speech.",info_upgrade:'Web jsSpeechFactory API is not supported by this browser. Upgrade to <a href="//www.google.com/chrome">Chrome</a> version 25 or later.',info_allow:'Click the "Allow" button above to enable your microphone.'}}}]),a.directive("jsSpeech",["jsSpeechFactory",function(a){return{restrict:"EAC",scope:!0,replace:!0,transclude:!0,require:"^ngModel",template:'<div class="jsSpeechFactory-container"><p ng-bind-html-unsafe="msg"></p><a class="jsSpeechFactory-btn" ng-click="toggleStartStop()"><img ng-src="{{icon}}" class="jsSpeechFactory-icon"/></a><textarea rows="4" class="form-control" ng-model="ngModel"></textarea></div>',link:function(b){var c,d,e;return c=b,e=!1,d=new webkitSpeechRecognition({continuous:!0,interimResults:!0}),c.msg=a.messages.info_setup,c.icon=a.icons.start,c.onstart=function(b){return c.$apply(function(){return c.icon=a.icons.recording}),console.log("onstart",b)},c.onerror=function(b,d){switch(console.log("onerror",b,d),b.error){case"not-allowed":return c.$apply(function(){return c.msg=a.messages.info_blocked});case"no-speech":return c.msg=a.messages.info_no_speech;case"aborted":return c.msg=a.messages.info_setup;case"audio-capture":return c.msg=a.messages.info_no_mic;case"bad-grammar":return c.msg=a.messages.info_no_speech;default:return console.log(b)}},c.onresult=function(b){var d,e,f,g,h;for(f=b.resultIndex,console.log("Handle results",b),c.$apply(function(){return c.icon=a.icons.recording,c.msg="Speak into the mic..."}),d=f,h=[];d<b.results.length;)e=b.results[d][0],g=e.transcript,c.ngModel=g,b.results[d].isFinal&&(console.log(g),c.ngModel=g),h.push(++d);return h},c.reset=function(b){return console.log("reset",b),e=!1,c.icon=a.icons.start,c.msg=a.messages.info_setup},c.toggleStartStop=function(){return e?(d.stop(),c.reset()):(d.start(),e=!0,c.ngModel="",c.icon=a.icons.blocked)},c.reset(),d.onerror=c.onerror,d.onend=c.reset,d.onresult=c.onresult,d.onstart=c.onstart}}}])}).call(this);
/**
 * angular-webspeech-directive
 * @version v0.0.1 - 2013-10-19
 * @link https://github.com/jonniespratley/angular-webspeech-directive
 * @author Jonnie Spratley <jonniespratley@me.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
(function(){"use strict";var a;angular.module("jonniespratley.angularWebspeechDirective",[]).directive("myDirective",function(){var a;return{restrict:"EAC",scope:!0,link:a=function(){var a;return a={startTimestamp:null,recognizing:!1,recording:!1,recognition:null,ignoreEnd:null,transcript:null,messages:{info_speak_now:"Speak now.",info_no_speech:'No speech was detected. You may need to adjust your <a href="//support.google.com/chrome/bin/answer.py?hl=en&amp;answer=1407892">microphone settings</a>.',info_no_mic:"No microphone was found. Ensure that a microphone is installed and that",info_blocked:"Permission to use microphone is blocked. To change, go to chrome://settings/contentExceptions#media-stream",info_denied:"Permission to use microphone was denied.",info_start:"Click on the microphone icon and begin speaking for as long as you like.",info_upgrade:'Web Speech API is not supported by this browser. Upgrade to <a href="//www.google.com/chrome">Chrome</a> version 25 or later.',info_allow:'Click the "Allow" button above to enable your microphone.'},model:{icon:null,status:null,message:null},elements:{icon:angular.element(".speech-icon"),btn:angular.element(".speech-btn"),container:angular.element(".speech-container"),hint:angular.element(".speech-hint"),status:angular.element(".speech-status"),message:angular.element(".speech-message")},icons:{start:"https://dl.dropboxusercontent.com/u/26906414/cdn/img/mic.gif",recording:"https://dl.dropboxusercontent.com/u/26906414/cdn/img/mic-animate.gif",blocked:"https://dl.dropboxusercontent.com/u/26906414/cdn/img/mic-slash.gif"},init:function(){return this.log("Speech.init()",this),"webkitSpeechRecognition"in window?this.setup():this.showUpgrade(),this.model.message=this.messages.info_start,this.model.icon=this.icons.start,this},onstart:function(b){return a.log("Speech.onstart()",b),a.recognizing=!0,a.showInfo("info_speak_now"),a.model.icon=a.icons.recording},onerror:function(b){return a.log("Speech.onerror()",b),"no-speech"===b.error&&(a.model.icon=a.icons.start,a.showInfo("info_no_speech"),a.ignoreEnd=!0),"audio-capture"===b.error&&(a.model.icon=a.icons.start,a.showInfo("info_no_microphone"),a.ignoreEnd=!0),"not-allowed"===b.error?(b.timeStamp-a.startTimestamp<100?a.showInfo("info_blocked"):a.showInfo("info_denied"),a.ignoreEnd=!0):void 0},onend:function(){return a.log("Speech.onend()"),a.recognizing=!1,a.ignoreEnd?void 0:(a.model.icon=a.icons.start,a.transcript?a.showInfo(""):(a.showInfo("info_start"),void 0))},onresult:function(b){var c,d;if(a.log("Speech.onresult()",b),d="","undefined"==typeof b.results)return this.recognition.onend=null,this.recognition.stop(),a.showUpgrade(),void 0;for(c=b.resultIndex;c<b.results.length;)b.results[c].isFinal?a.transcript+=b.results[c][0].transcript:d+=b.results[c][0].transcript,++c;return a.transcript=a.capitalize(a.transcript),a.transcript||d},showInfo:function(a){return this.log("Speech.showInfo()",this),this.model.message=this.messages[a]},showUpgrade:function(){return this.log("Speech.showUpgrade()",this)},setup:function(){return this.log("Speech.setup()",this),this.recognition=new webkitSpeechRecognition,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.onstart=this.onstart,this.recognition.onerror=this.onerror,this.recognition.onend=this.onend,this.recognition.onresult=this.onresult},start:function(){return this.log("Speech.start()"),this.recognizing?(this.recognition.stop(),void 0):(this.startTimestamp=new Date,this.recognition.start())},stop:function(){return this.log("Speech.stop()")},capitalize:function(){},linebreak:function(){},log:function(){return console.log(arguments)}}}}}),a=function(){if("undefinded"!=typeof speechRecognition)return new speechRecognition;if("undefined"!=typeof msSpeechRecognition)return new msSpeechRecognition;if("undefined"!=typeof mozSpeechRecognition)return new mozSpeechRecognition;if("undefined"!=typeof webkitSpeechRecognition)return new webkitSpeechRecognition;throw new Error("No speech recognition API detected!")}}).call(this);